# Contents

- [Sysdig](#Sysdig)
- [CSysdig - gui](#CSysdig - gui)

:sysdig:csysdig:

# Sysdig

Sysdig:
    * system level exploration and troubleshooting tool
        * on windows and mac it works with trace files, not live like on linux
    * free and opensource
    * capture system events
    * combines funcs of the tools above
    * a little like process monitor on Win
    * supports containers
    * lightweight
    * cpu, memory, disk usage, apps etc
    * `sysdig` - cli tool
    * `csysdig` - gui

You'll need to run it as a root :).

`sysdig proc.name=ssh` look at a suspicious process.

`sysdig -c topprocs_net` look at top processes using network. `-c` uses built-in scripts

`sysdig -c topprocs_cpu` top processes that use CPU

It's possible for a hacker to hide processes by intercepting queries to /proc. However, sysdig gets information from the system calls, so it is not prone to this trick.

`sysdig -p"%evt.arg.path" "evt.type=chdir and user.name=root"` see what dirs root user accessed
    * evt is event

`sysdig fd.name contains /path/to/dir` see if there is any activity on the dir
    * fd is file descriptor
    * this returns also data when file is open

`sysdig evt.type=open and fd.name contains /path/to/dir`
    * see just the open files

`sysdig -qw dumpfile.scap` If you capture to file you can later take this to csysdig gui tool

`sysdig -r dumpfile.scap` reads the capture file
    `sysdig -r dumpfile.scap -c topprocs_cpu` outputs only relevant cpu usage info

`sysdig -s 4096 -z -w dumpfile.scap.gz` if you do a capture for a long time - compress it
    * `-s` specify how many bytes of each data buffer to write to disk. Default is 80.
    * `-z` gzip. Used along with `-w` write to disk

Websites
Sysdig User Guide
https://github.com/draios/sysdig/wiki/Sysdig-User-Guide
Software
Sysdig
http://www.sysdig.org
Sysdig
https://sysdig.com/

# CSysdig - gui

Csysdig is the gui for sysdig.

All admin tools in one ui.

`csysdig` run it as root.

A lot of the keys that work in htop will work in csysdig. It's a design choice.

What funcs you get with the cli tool:
    * strace
    * tcpdupm
    * lsof
    * lua

What Csysdig adds:
    * htop
    * iftop
    * iotop

Viewing: (ex: Processes) shows what the view is.
    * F2 changes views.
    * Useful for malware:
        - Connections - this view lists top network connections. Lists all of connections active, with details.
        - Spy Syslog: entries entered into syslog.
        - Spy Users: lists all the commands run interactively, with the shell as the parent process, by user, sorted by time.
        - Directories: lists dirs accessed on the filesystem, can be sorted.
        - Files: list files accessed on the filesystem.
    * F5 Echo:
        - Echo displays a readable buffer for the process
    * F4 Filter:
        - you can set your own filter, or text to match
        - whenever you add filters, they are added based on the current context
    * F6 Dig:
        - gives you a full sysdig output for the process
    * Enter:
        - pressing enter on the process allows you to drill in
        - if the process has multiple threads, they will be presented to you separately

For: shows what the filter is/was for the capture.

Source: will say either live capture or list the file from which it read.

Filter: shows the filter for the current view.

Columns:
    * PID
    * CPU usage
    * User who launched the proc
    * Num of Threads
    * Virtual memory used total by this proc
    * Residual - physical memory used by the proc
    * File I/O bandwidth generated by the proc
    * Network I/O badwidth generated by the proc
    * Command launched by the proc

You can sort by columns.

Real time analysis is being refreshed every 2 sec by default.

You can change refresh to another number of sec, like 5 sec `sysdig -d 5000`.

Creating trace files `sysdig -wq dumpfile.scap`, then you would read it in `csysdig -r dumpfile.scap`.


Software
Sysdig
http://www.sysdig.org
Websites
Sysdig Quick Reference Guide
https://github.com/draios/sysdig/wiki/sysdig-quick-reference-guide#wiki-basic-command-list
Sysdig Examples
http://www.sysdig.org/wiki/sysdig-examples/
